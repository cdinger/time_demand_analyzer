<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>asdf</title>

  <link href="/bootstrap/css/bootstrap.css" rel="stylesheet">
  <link href="/bootstrap/css/bootstrap-responsive.css" rel="stylesheet">

  <script src="/js/lib/jquery-1.9.1.js"></script>
  <script src="/bootstrap/js/bootstrap.js"></script>
  <script src="/js/lib/underscore.js"></script>
  <script src="/js/lib/backbone.js"></script>
  <script src="/js/lib/d3.v3.js"></script>

  <script src="/js/models/task.js"></script>
  <script src="/js/collections/tasks.js"></script>
  <script src="/js/views/tasks.js"></script>

  <style type="text/css">
    li {
      list-style:none;
      display:block;
      margin: 10px 10px 10px 0;

    }
    li span.value, li input {
      width: 20px;
    }
    li input[type=text] {
      display:none;
    }
    li.editing input[type=text] {
      display:inline
    }
    li.editing span {
      display:none;
    }
    			/* tell the SVG path to be a thin blue line without any area fill */
			path {
				stroke: steelblue;
				stroke-width: 1;
				fill: none;
			}
			
			.axis {
			  shape-rendering: crispEdges;
			}

			.x.axis line {
			  stroke: lightgrey;
			}

			.x.axis .minor {
			  stroke-opacity: .5;
			}

			.x.axis path {
			  display: none;
			}

			.y.axis line, .y.axis path {
			  fill: none;
			  stroke: #000;
			}
  </style>

  <script type="text/template" id="task-template">
    T<sub><%- index %></sub> = (
    p<sub><%- index %></sub>=<input type="text" value="<%- period %>" /> <span class="value"><%- period %></span>,
    e<sub><%- index %></sub>=<span class="value"><%- executionTime %></span>,
    d<sub><%- index %></sub>=<span class="value"><%- deadline %></span>
    )
  </script>

  <script>
    var TaskView = Backbone.View.extend({
      tagName: "li",
      template: _.template( $('#task-template').html() ),
      initialize: function() {
        this.listenTo(this.model, "change", this.render);
        this.model.bind('change', this.render, this);
      },
      events: {
        'dblclick': 'edit',
        'blur input': 'close'
      },
      render: function() {
        this.$el.html( this.template( this.model.toJSON() ) );
        this.input = this.$('input');
        return this;
      },
      edit: function() {
        this.$el.addClass("editing");
        this.input.focus();
      },
      close: function() {
        var value = this.input.val();
        if (!value) {
          this.clear();
        } else {
          // this.model.save({period: value});
          this.model.set({period: value});
          this.$el.removeClass("editing");
        }
      }
    });

    var AppView = Backbone.View.extend({
      el: $('#app'),
      initialize: function() {
        this.listenTo(Tasks, 'add', this.addOne);
      },
      addOne: function(task) {
        task.set({index: Tasks.indexOf(task) + 1});
        var view = new TaskView({model: task});
        $("#task-list").append(view.render().el);
      }
    });

    var Tasks = new TaskSet();
    var App = new AppView();

    $(function() {
      Tasks.add(new Task({period: 25, executionTime: 8}));
      Tasks.add(new Task({period: 50, executionTime: 13}));
      Tasks.add(new Task({period: 100, executionTime: 40}));
    });

    $(function() {
      // define dimensions of graph
      var m = [80, 80, 80, 80]; // margins
      var w = 500 - m[1] - m[3]; // width
      var h = 500 - m[0] - m[2]; // height
      
      // create a simple data array that we'll plot with a line (this array represents only the Y values, X will just be the index location)
      var data = [3, 6, 2, 7, 5, 2, 0, 3, 8, 9, 2, 5, 9, 3, 6, 3, 6, 2, 7, 5, 2, 1, 3, 8, 9, 2, 5, 9, 2, 7];

      // X scale will fit all values from data[] within pixels 0-w
      var x = d3.scale.linear().domain([0, data.length]).range([0, w]);
      // Y scale will fit values from 0-10 within pixels h-0 (Note the inverted domain for the y-scale: bigger is up!)
      var y = d3.scale.linear().domain([0, 10]).range([h, 0]);
        // automatically determining max range can work something like this
        // var y = d3.scale.linear().domain([0, d3.max(data)]).range([h, 0]);

      // create a line function that can convert data[] into x and y points
      var line = d3.svg.line()
        // assign the X function to plot our line as we wish
        .x(function(d,i) { 
          // verbose logging to show what's actually being done
          console.log('Plotting X value for data point: ' + d + ' using index: ' + i + ' to be at: ' + x(i) + ' using our xScale.');
          // return the X coordinate where we want to plot this datapoint
          return x(i); 
        })
        .y(function(d) { 
          // verbose logging to show what's actually being done
          console.log('Plotting Y value for data point: ' + d + ' to be at: ' + y(d) + " using our yScale.");
          // return the Y coordinate where we want to plot this datapoint
          return y(d); 
        })

        // Add an SVG element with the desired dimensions and margin.
        var graph = d3.select("#graph").append("svg:svg")
              .attr("width", w + m[1] + m[3])
              .attr("height", h + m[0] + m[2])
            .append("svg:g")
              .attr("transform", "translate(" + m[3] + "," + m[0] + ")");

        // create yAxis
        var xAxis = d3.svg.axis().scale(x).tickSize(-h).tickSubdivide(true);
        // Add the x-axis.
        graph.append("svg:g")
              .attr("class", "x axis")
              .attr("transform", "translate(0," + h + ")")
              .call(xAxis);


        // create left yAxis
        var yAxisLeft = d3.svg.axis().scale(y).ticks(4).orient("left");
        // Add the y-axis to the left
        graph.append("svg:g")
              .attr("class", "y axis")
              .attr("transform", "translate(-25,0)")
              .call(yAxisLeft);
        
          // Add the line by appending an svg:path element with the data line we created above
        // do this AFTER the axes above so that the line is above the tick-lines
          graph.append("svg:path").attr("d", line(data));
      });

  </script>
</head>
<body>
  <div class="containter">
    <div class="page-header">
      <h1>Time-demand analyzer</h1>
    </div>
    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do
    eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim
    ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut
    aliquip ex ea commodo consequat. Duis aute irure dolor in
    reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla
    pariatur. Excepteur sint occaecat cupidatat non proident, sunt in
    culpa qui officia deserunt mollit anim id est laborum.</p>
    <div id="app">
      <h2>Tasks</h2>
      <ul id="task-list">
      </ul>
      <div id="graph"></div>
    </div>
  </div>
  <script src="js/chart.js"></script>
</body>
</html>
